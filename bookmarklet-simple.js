javascript:(function(){if(window.fpMS){alert('Already active!');return;}var w=window.fpMS={f:[],a:0};var eh=function(t){var d=document.createElement('div');d.textContent=t;return d.innerHTML;};var p=document.createElement('div');p.id='fpP';p.style.cssText='position:fixed;top:0;right:0;width:400px;height:100vh;background:white;box-shadow:-4px 0 12px rgba(0,0,0,0.3);z-index:999999;display:flex;flex-direction:column;font-family:Arial,sans-serif';p.innerHTML='<div style="background:linear-gradient(135deg,#667eea,#764ba2);padding:20px;color:white"><div style="display:flex;justify-content:space-between;align-items:center"><div><h2 style="margin:0;font-size:20px">ðŸŽ¯ Field Picker</h2><p style="margin:8px 0 0;font-size:13px;opacity:0.9">Multi-select field picker</p></div><button id="fpX" style="background:rgba(255,255,255,0.2);border:none;color:white;width:32px;height:32px;border-radius:50%;cursor:pointer;font-size:24px;line-height:1;padding:0">&times;</button></div></div><div style="padding:16px;background:#f8f9fa;border-bottom:2px solid #e2e8f0"><button id="fpA" style="width:100%;background:linear-gradient(135deg,#667eea,#764ba2);color:white;border:none;padding:14px;border-radius:8px;cursor:pointer;font-weight:600">ðŸš€ Activate</button></div><div style="flex:1;overflow-y:auto;padding:16px"><div style="font-weight:600;margin-bottom:12px">Selected: <span id="fpC">0</span></div><div id="fpL"><div style="text-align:center;padding:40px 20px;color:#7f8c8d"><div style="font-size:48px;margin-bottom:12px">ðŸ“‹</div><div>No fields</div></div></div></div><div style="padding:16px;border-top:2px solid #e2e8f0;background:#f8f9fa;display:flex;gap:8px"><button id="fpJ" disabled style="flex:1;background:#3498db;color:white;border:none;padding:14px;border-radius:8px;cursor:pointer;font-weight:600;opacity:0.5">ðŸ“‹ Copy JSON</button><button id="fpS" disabled style="flex:1;background:#27ae60;color:white;border:none;padding:14px;border-radius:8px;cursor:pointer;font-weight:600;opacity:0.5">ðŸ’¾ Save All</button></div>';document.body.appendChild(p);var b=document.createElement('div');b.id='fpB';b.style.cssText='position:fixed;top:0;left:50%;transform:translateX(-50%);background:#27ae60;color:white;padding:12px 24px;border-radius:0 0 8px 8px;z-index:999998;font-weight:600;display:none';b.textContent='ðŸŽ¯ Active - RIGHT-CLICK fields (ESC to stop)';document.body.appendChild(b);var getOpts=function(f){var opts=[];if(f.tagName==='SELECT'&&f.options){Array.from(f.options).forEach(function(o){if(o.value)opts.push({label:o.textContent.trim(),value:o.value});});}else if(f.tagName==='INPUT'){var par=f.closest('[data-element]')||f.parentElement;var sel=par?par.querySelector('select'):null;if(sel&&sel.options){Array.from(sel.options).forEach(function(o){if(o.value)opts.push({label:o.textContent.trim(),value:o.value});});}if(!opts.length&&f.hasAttribute('list')){var dl=document.getElementById(f.getAttribute('list'));if(dl){var dlopts=dl.querySelectorAll('option');dlopts.forEach(function(o){if(o.value)opts.push({label:o.textContent.trim()||o.value,value:o.value});});}}if(!opts.length){['data-options','data-values','data-recent'].forEach(function(attr){if(f.hasAttribute(attr)){try{var data=JSON.parse(f.getAttribute(attr));if(Array.isArray(data)){data.forEach(function(item){if(typeof item==='string')opts.push({label:item,value:item});else if(item.label&&item.value)opts.push(item);});};}catch(e){}}});}if(!opts.length){var drops=document.querySelectorAll('.select2-results__option, .ac_results li, .sn-popover-basic li, [role="option"]');drops.forEach(function(opt){var txt=opt.textContent.trim();if(txt&&opt.offsetParent!==null)opts.push({label:txt,value:txt});});}}return opts;};var upd=function(){document.getElementById('fpC').textContent=w.f.length;var s=document.getElementById('fpS');var j=document.getElementById('fpJ');s.disabled=w.f.length===0;j.disabled=w.f.length===0;s.style.opacity=w.f.length?'1':'0.5';j.style.opacity=w.f.length?'1':'0.5';var l=document.getElementById('fpL');if(!w.f.length){l.innerHTML='<div style="text-align:center;padding:40px 20px;color:#7f8c8d"><div style="font-size:48px;margin-bottom:12px">ðŸ“‹</div><div>No fields</div></div>';}else{l.innerHTML=w.f.map(function(f,i){var optsInfo=f.fieldType==='combobox'&&f.options&&f.options.length?' <span style="color:#6c757d;">('+f.options.length+' options)</span>':'';return'<div style="background:#f8f9fa;padding:12px;border-radius:8px;margin-bottom:12px;border-left:4px solid #667eea"><div style="display:flex;justify-content:space-between;margin-bottom:8px"><div style="font-weight:600;font-size:14px">'+eh(f.label||f.id)+optsInfo+'</div><button onclick="window.fpMS.rm('+i+')" style="background:#e74c3c;color:white;border:none;padding:4px 10px;border-radius:4px;cursor:pointer;font-size:11px">Remove</button></div><div style="font-size:12px;color:#7f8c8d">ID: '+eh(f.id)+' | Type: '+eh(f.fieldType)+'</div></div>';}).join('');}var a=document.getElementById('fpA');if(w.a){a.textContent='â¸ï¸ Active (ESC)';a.style.background='#95a5a6';a.disabled=1;document.body.style.cursor='crosshair';b.style.display='block';}else{a.textContent='ðŸš€ Activate';a.style.background='linear-gradient(135deg,#667eea,#764ba2)';a.disabled=0;document.body.style.cursor='';b.style.display='none';}};w.rm=function(i){w.f.splice(i,1);upd();};var act=function(){if(w.a)return;w.a=1;upd();};var deact=function(){if(!w.a)return;w.a=0;upd();};var close=function(){if(w.f.length&&!confirm('Close without saving? '+w.f.length+' field(s) will be lost.'))return;p.remove();b.remove();document.removeEventListener('contextmenu',rclk,true);document.removeEventListener('mouseover',hov,true);document.removeEventListener('mouseout',hovout,true);document.removeEventListener('keydown',esc);document.body.style.cursor='';delete window.fpMS;};var rclk=function(e){if(!w.a||e.target.closest('#fpP')||e.target.closest('#fpB'))return;var f=e.target.matches('input,select,textarea')?e.target:e.target.closest('input,select,textarea');if(!f)return;e.preventDefault();e.stopPropagation();var id=f.id||f.name||f.getAttribute('aria-labelledby')||f.getAttribute('data-element');if(!id){alert('No ID found!');return;}if(w.f.some(function(x){return x.id===id})){var o=f.style.background;f.style.background='#e74c3c';setTimeout(function(){f.style.background=o;},300);return;}var lbl=id;var al=f.getAttribute('aria-labelledby');if(al){var le=document.getElementById(al);if(le)lbl=le.textContent.trim();}else{var lf=document.querySelector('label[for="'+f.id+'"]');if(lf)lbl=lf.textContent.trim();}lbl=lbl.replace(/[*:]/g,'').replace(/\s*(Required|Mandatory)\s*/gi,'').trim();var ft='text';var opts=getOpts(f);if(f.tagName==='SELECT'||opts.length>0)ft='combobox';else if(f.tagName==='TEXTAREA')ft='text';else if(f.type)ft=f.type;var req=f.required||f.getAttribute('aria-required')==='true'||f.getAttribute('mandatory')==='true';w.f.push({id:id,label:lbl,fieldType:ft,required:req,options:opts});var o=f.style.background;f.style.background='#27ae60';setTimeout(function(){f.style.background=o;},300);upd();};var hov=function(e){if(!w.a||e.target.closest('#fpP')||e.target.closest('#fpB'))return;var f=e.target.matches('input,select,textarea')?e.target:e.target.closest('input,select,textarea');if(f)f.style.outline='2px solid #3498db';};var hovout=function(e){if(!w.a)return;var f=e.target.matches('input,select,textarea')?e.target:e.target.closest('input,select,textarea');if(f)f.style.outline='';};var esc=function(e){if(e.key==='Escape')deact();};document.addEventListener('contextmenu',rclk,true);document.addEventListener('mouseover',hov,true);document.addEventListener('mouseout',hovout,true);document.addEventListener('keydown',esc);document.getElementById('fpA').onclick=act;document.getElementById('fpX').onclick=close;document.getElementById('fpJ').onclick=function(){if(!w.f.length){alert('No fields!');return;}var json=JSON.stringify(w.f,null,2);navigator.clipboard.writeText(json).then(function(){var btn=document.getElementById('fpJ');var orig=btn.textContent;btn.textContent='âœ“ Copied!';setTimeout(function(){btn.textContent=orig;},2000);}).catch(function(){alert('Copy failed! Check console.');console.log(json);});};document.getElementById('fpS').onclick=function(){if(!w.f.length){alert('No fields!');return;}localStorage.setItem('jiraLinkGen_pendingFieldImport',JSON.stringify({timestamp:Date.now(),fields:w.f}));alert('âœ… Saved '+w.f.length+' fields!\\n\\nGo back to Link Generator tab.');w.f=[];upd();deact();};upd();})();
