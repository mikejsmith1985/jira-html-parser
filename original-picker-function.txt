
>     function generateFieldPickerBookmarklet() {
        return `(function(){if(window.fieldPickerActive){alert('Field Picker is already active!');return;}window.fieldPickerActive=true;const escapeHtml=(text)=>{const div=document.createElement('div');div.textContent=text;return div.innerHTML;};let banner=document.createElement('div');banner.id='fpBanner';banner.style.cssText='position:fixed;top:0;left:50%;transform:translateX(-50%);background:#27ae60;color:white;padding:12px 24px;border-radius:0 0 8px 8px;z-index:999998;font-family:Arial,sans-serif;font-size:14px;box-shadow:0 2px 8px rgba(0,0,0,0.3);pointer-events:none;';banner.textContent='≡ƒÄ» Field Picker Active - Click any field to inspect (ESC to exit)';document.body.appendChild(banner);document.body.style.cursor='crosshair';const handleClick=(e)=>{const field=e.target.matches('input,select,textarea')?e.target:e.target.closest('input,select,textarea');if(!field)return;e.preventDefault();e.stopPropagation();const fieldId=field.id||field.name;const fieldName=field.name;const currentValue=field.value;let label=fieldId;const ariaLabelledBy=field.getAttribute('aria-labelledby');if(ariaLabelledBy){const labelEl=document.getElementById(ariaLabelledBy);if(labelEl)label=labelEl.textContent.trim();}else{const labelFor=document.querySelector(\`label[for="\${field.id}"]\`);if(labelFor)label=labelFor.textContent.trim();}label=label.replace(/[*:]/g,'').trim();label=label.replace(/\\s+(Required|Mandatory)[\\s.,;:!?]*$/gi,'').trim();label=label.replace(/\\s+(Required|Mandatory)\\b/gi,'').trim();let fieldType='text';if(field.tagName==='SELECT')fieldType='combobox';else if(field.tagName==='TEXTAREA')fieldType='text';const isRequired=field.required||field.getAttribute('aria-required')==='true'||field.hasAttribute('required');let options=[];let optionCount=0;if(fieldType==='combobox'&&field.options){Array.from(field.options).forEach(opt=>{if(opt.value){options.push({label:opt.textContent.trim(),value:opt.value});}});optionCount=options.length;}showModal({id:fieldId,name:fieldName,label:label,fieldType:fieldType,required:isRequired,currentValue:currentValue,options:options,optionCount:optionCount});};const handleHover=(e)=>{const field=e.target.matches('input,select,textarea')?e.target:e.target.closest('input,select,textarea');if(field&&!field.closest('#fpModal')){field.style.outline='2px solid #3498db';}};const handleHoverOut=(e)=>{const field=e.target.matches('input,select,textarea')?e.target:e.target.closest('input,select,textarea');if(field){field.style.outline='';}};const handleEscape=(e)=>{if(e.key==='Escape'){deactivate();}};const showModal=(meta)=>{let modal=document.getElementById('fpModal');if(modal)modal.remove();let backdrop=document.getElementById('fpBackdrop');if(!backdrop){backdrop=document.createElement('div');backdrop.id='fpBackdrop';backdrop.style.cssText='position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.7);z-index:999999;display:flex;align-items:center;justify-content:center;';document.body.appendChild(backdrop);}modal=document.createElement('div');modal.id='fpModal';modal.style.cssText='background:white;border-radius:12px;padding:24px;max-width:500px;width:90%;max-height:80vh;overflow-y:auto;box-shadow:0 10px 40px rgba(0,0,0,0.3);font-family:Arial,sans-serif;position:relative;';const showAllOptions=meta.optionCount>0&&meta.optionCount<50;const hasLargeDropdown=meta.optionCount>=50;let html=\`<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;"><h3 style="margin:0;color:#2c3e50;">≡ƒÄ» Field Details</h3><button id="fpCloseBtn" style="background:none;border:none;font-size:24px;cursor:pointer;color:#95a5a6;">&times;</button></div><div style="margin-bottom:12px;"><strong>Field ID:</strong> <code style="background:#ecf0f1;padding:2px 6px;border-radius:3px;">\${escapeHtml(meta.id)}</code> <button class="fpCopyBtn" data-copy="\${escapeHtml(meta.id)}" style="margin-left:8px;background:#3498db;color:white;border:none;padding:4px 12px;border-radius:4px;cursor:pointer;font-size:12px;">Copy</button></div><div style="margin-bottom:12px;"><strong>Label:</strong> \${escapeHtml(meta.label)} <button class="fpCopyBtn" data-copy="\${escapeHtml(meta.label)}" style="margin-left:8px;background:#3498db;color:white;border:none;padding:4px 12px;border-radius:4px;cursor:pointer;font-size:12px;">Copy</button></div><div style="margin-bottom:12px;"><strong>Type:</strong> \${meta.fieldType}</div><div style="margin-bottom:12px;"><strong>Required:</strong> \${meta.required?'Yes ΓÜá∩╕Å':'No'}</div>\`;if(meta.currentValue){html+=\`<div style="margin-bottom:12px;"><strong>Current Value:</strong> <span style="color:#27ae60;">\${escapeHtml(meta.currentValue)}</span></div>\`;}if(showAllOptions){html+=\`<div style="margin-bottom:12px;"><strong>Options (\${meta.optionCount}):</strong> <button class="fpCopyBtn" data-copy='\${JSON.stringify(meta.options)}' style="margin-left:8px;background:#3498db;color:white;border:none;padding:4px 12px;border-radius:4px;cursor:pointer;font-size:12px;">Copy</button><ul style="margin:8px 0;padding-left:20px;max-height:200px;overflow-y:auto;">\`;meta.options.forEach(opt=>{html+=\`<li>\${escapeHtml(opt.label)} <span style="color:#7f8c8d;">(value: \${escapeHtml(opt.value)})</span></li>\`;});html+=\`</ul></div>\`;}else if(hasLargeDropdown){html+=\`<div style="margin-bottom:12px;padding:12px;background:#ecf0f1;border-radius:6px;"><p style="margin:0;color:#7f8c8d;font-size:13px;">Γä╣∩╕Å This field has \${meta.optionCount.toLocaleString()} options. Current value shown above.</p></div>\`;}html+=\`<div style="text-align:center;margin-top:20px;"><button id="fpCopyJsonBtn" style="background:#27ae60;color:white;border:none;padding:10px 20px;border-radius:6px;cursor:pointer;font-size:14px;font-weight:600;">Copy Field as JSON</button></div>\`;modal.innerHTML=html;backdrop.appendChild(modal);document.getElementById('fpCloseBtn').onclick=()=>{modal.remove();backdrop.style.display='none';backdrop.remove();};document.querySelectorAll('.fpCopyBtn').forEach(btn=>{btn.onclick=()=>{const text=btn.getAttribute('data-copy');if(navigator.clipboard){navigator.clipboard.writeText(text);}else{const textarea=document.createElement('textarea');textarea.value=text;document.body.appendChild(textarea);textarea.select();document.execCommand('copy');document.body.removeChild(textarea);}const originalText=btn.textContent;btn.textContent='Γ£ô Copied!';btn.style.background='#27ae60';setTimeout(()=>{btn.textContent=originalText;btn.style.background='#3498db';},1000);};});document.getElementById('fpCopyJsonBtn').onclick=()=>{const json={id:meta.id,label:meta.label,fieldType:meta.fieldType,required:meta.required};if(meta.options.length>0&&meta.options.length<50){json.options=meta.options;}const jsonStr=JSON.stringify(json,null,2);if(navigator.clipboard){navigator.clipboard.writeText(jsonStr);}else{const textarea=document.createElement('textarea');textarea.value=jsonStr;document.body.appendChild(textarea);textarea.select();document.execCommand('copy');document.body.removeChild(textarea);}const btn=document.getElementById('fpCopyJsonBtn');const originalText=btn.textContent;btn.textContent='Γ£ô Copied!';btn.style.background='#27ae60';setTimeout(()=>{btn.textContent=originalText;btn.style.background='#27ae60';},1000);};backdrop.style.display='flex';};const deactivate=()=>{window.fieldPickerActive=false;if(banner)banner.remove();const modal=document.getElementById('fpModal');if(modal)modal.remove();const backdrop=document.getElementById('fpBackdrop');if(backdrop)backdrop.remove();document.body.style.cursor='';document.removeEventListener('click',handleClick,true);document.removeEventListener('keydown',handleEscape,true);document.removeEventListener('mouseover',handleHover,true);document.removeEventListener('mouseout',handleHoverOut,true);};document.addEventListener('click',handleClick,true);document.addEventListener('keydown',handleEscape,true);document.addEventListener('mouseover',handleHover,true);document.addEventListener('mouseout',handleHoverOut,true);})();`;
      }
  
      // Initialize dropdowns and restore state on page load
      window.addEventListener('DOMContentLoaded', () => {
        // Restore app type from storage or default to 'servicenow'
        const savedAppType = localStorage.getItem('linkGenAppType') || 'servicenow';
        switchAppType(savedAppType);
        
        // Populate all dropdowns (starts with clean/empty selections)
        populateBaseUrlDropdown();
        populateIssueTypeDropdown();
        populateProjectIdDropdown();
        
        // Don't restore form state - user wants clean slate every time
        // Only app type is remembered (handled above)
      });
      
      function saveState() {
        // Save filter checkbox preference only (useful to remember)
        const state = {
          filterFieldsByIssueType: document.getElementById('filterFieldsByIssueType')?.checked || false
        };
        localStorage.setItem('linkGenFormState', JSON.stringify(state));
      }
      
      function restoreState() {
        try {
          const saved = localStorage.getItem('linkGenFormState');
          if (saved) {
            const state = JSON.parse(saved);
            // Only restore the filter checkbox preference
            if (state.filterFieldsByIssueType !== undefined) {
              const filterCheckbox = document.getElementById('filterFieldsByIssueType');
              if (filterCheckbox) filterCheckbox.checked = state.filterFieldsByIssueType;
            }
          }
        } catch (e) {
          console.error('Error restoring state:', e);
        }
      }
    </script>
  </body>
  </html>

